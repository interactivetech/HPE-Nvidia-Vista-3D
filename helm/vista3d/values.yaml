# Default values for vista3d
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

global:
  imageRegistry: ""
  imagePullSecrets: []

# Backend is disabled - only frontend and image server are deployed

frontend:
  enabled: true
  name: vista3d-frontend
  replicaCount: 1
  image:
    repository: mendeza/vista3d-frontend
    tag: v1.0.5
    pullPolicy: Always
  service:
    type: ClusterIP
    port: 8501
    targetPort: 8501
  env:
    VISTA3D_SERVER: "http://vista3d-image-server:8888"
    VISTA3D_API_KEY: "<UPDATE>"
    IMAGE_SERVER: "http://vista3d-image-server:8888"
    EXTERNAL_IMAGE_SERVER: "http://vista3d-image-server:8888"
    VISTA3D_IMAGE_SERVER_URL: "http://vista3d-image-server:8888"
    OUTPUT_FOLDER: "/app/output"
    DICOM_FOLDER: "/app/dicom"
    DOCKER_CONTAINER: "true"
    STREAMLIT_SERVER_RUN_ON_SAVE: "true"
    STREAMLIT_SERVER_FILE_WATCHER_TYPE: "auto"
  volumeMounts:
    - name: output-data
      mountPath: /app/output
    - name: dicom-data
      mountPath: /app/dicom

imageServer:
  enabled: true
  name: fileserver # Changed from vista3d-image-server to match your preference
  replicaCount: 1
  image:
    repository: python
    tag: 3.12-alpine # Your desired image
    pullPolicy: IfNotPresent
  # New section for the Init Container that will download the data
  initContainer:
    image: alpine:latest
    sampleDataUrl: "https://media.githubusercontent.com/media/dw-flyingw/HPE-Nvidia-Vista-3D/main/sample_data.tgz"
  service:
    type: ClusterIP
    port: 8888       # Your fileserver port
    targetPort: 8888
  # This volume mount will be shared between the init container and main container
  volumeMounts:
    - name: shared-data
      mountPath: /mnt # Mount path for the python http.server

backend:
  enabled: false
  name: vista3d-backend
  # WARNING: For development/testing only. Do not commit this file with the key to a public repository.
  ngcApiKey: "nvapi-YOUR_NGC_API_KEY_HERE" # <-- PASTE YOUR KEY HERE
  image:
    repository: nvcr.io/nim/nvidia/vista3d
    tag: "1.0.0"
    pullPolicy: IfNotPresent
  service:
    type: ClusterIP
    port: 8000
  nodeSelector:
    nvidia.com/gpu: "true"
  resources:
    limits:
      nvidia.com/gpu: 1
  volumeMounts:
    - name: output-data
      mountPath: /workspace/output

persistence:
  enabled: true
  # This new 'shared' section allows specifying your existing PVC
  shared:
    # IMPORTANT: Set the name of your existing PVC here.
    existingClaim: "kubeflow-shared-pvc"
    # The subPath allows you to use specific folders within your PVC
    dicomSubPath: "vista3d/dicom"
    outputSubPath: "vista3d/output"

sampleData:
  enabled: false
  url: "https://media.githubusercontent.com/media/dw-flyingw/HPE-Nvidia-Vista-3D/main/sample_data.tgz"
  extractToDicom: true
  extractToOutput: true

serviceAccount:
  create: true
  annotations: {}
  name: ""

# Secrets not needed for frontend/image server only deployment

ingress:
  enabled: false
  className: "nginx"
  annotations: {}
  hosts:
    - host: vista3d.local
      paths:
        - path: /
          pathType: Prefix
  tls: []
ezua:
  enabled: true
  virtualService:
    # The external hostname for the service.
    # IMPORTANT: Update this to match your PCAI environment's ingress domain.
    # This is a placeholder you need to replace.
    endpoint: "vista3d-frontend.${DOMAIN_NAME}"

    # The Istio gateway to bind to. This is the standard gateway for PCAI.
    istioGateway: "istio-system/ezaf-gateway"